#!/bin/bash

set -e
set -a

# https://github.com/pgRouting/osm2pgrouting#tips

cd "$( dirname "${BASH_SOURCE[0]}" )"

. ../../.env

psql -c 'CREATE SCHEMA IF NOT EXISTS pgrouting;'

CLEAN_ONCE='--clean'

find data/osm -regex '.*\(upstate\|downstate\).*.[0-9]+.osm' |
  sort |
  while read -r f; do
    osm2pgrouting \
      --f "$f" \
      --conf ./mapconfig_for_cars.xml \
      --dbname "$PGDATABASE" \
      --schema 'pgrouting' \
      --tags \
      --addnodes \
      --attributes \
      --host "$PGHOST" \
      --port "$PGPORT" \
      --username "$PGUSER" \
      --password "$PGPASSWORD" \
      "$CLEAN_ONCE"

    CLEAN_ONCE=''
  done
