#!/bin/bash

set -Ee

print_usage()
{
  (>&2 cat <<- _EOF_
NAME: download_newyork_polygon

SYNOPSIS:
    OSM_DATA_DIR=dir download_newyork_polygon

DESCRIPTION:
  Download the New York State polygon file from geofabrik.de. This file is used to extract NYS from the entire OSM planet.

  Requires the following two ENV variables to be set:
      * OSM_DATA_DIR
_EOF_
  )
}

if [ -z "$OSM_DATA_DIR" ]; then
  print_usage
  exit 1
fi

source ./set_convention_vars

mkdir -p "$( dirname "$NYS_POLY_FILE_PATH" )"

# clean up the download file.
remove_download_file() {
  (>&2 echo "ERROR: download_newyork_polygon failed.")
  rm -f "$NYS_POLY_FILE_PATH"
}
trap cleanup ERR

if [ ! -f "$NYS_POLY_FILE_PATH" ]; then
  curl 'http://download.geofabrik.de/north-america/us/new-york.poly' > "$NYS_POLY_FILE_PATH"
else
  (>&2 echo "WARNING: $NYS_POLY_FILE_PATH already exists. Skipping download.")
fi
