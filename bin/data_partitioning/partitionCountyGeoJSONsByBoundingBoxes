#!/bin/bash

set -e

if [ "$#" -ne 2 ]; then
  (>&2 echo 'USAGE: You must provide two positional CLI argument:')
  (>&2 echo '         1st: the county GeoJSONs directory.')
  (>&2 echo '         2nd: the partitioned county GeoJSONs directory')
  exit 1
fi

IN_DIR="$( realpath "$1" )"

if [ ! -d "$IN_DIR" ]; then
  (>&2 echo "ERROR: No directory found at $IN_DIR")
  exit 1
fi

mkdir -p "$2"
OUT_DIR="$( realpath "$2" )"

pushd "$( dirname "${BASH_SOURCE[0]}" )/" >/dev/null

find "$IN_DIR" -type f |
  sort |
  while read -r f; do
    ./partitionGeoJSONByBoundingBoxes --geoJSON "$f" --outDir "$OUT_DIR"
done

popd >/dev/null
