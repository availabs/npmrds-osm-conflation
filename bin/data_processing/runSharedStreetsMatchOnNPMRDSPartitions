#!/bin/bash

set -e

if [ "$#" -ne 2 ]; then
  (>&2 echo 'USAGE: You must provide two positional CLI argument:')
  (>&2 echo '         1st: the path to the directory of NPMRDS GeoJSONs files')
  (>&2 echo '         2nd: the output directory')
  exit 1
fi

if [ ! -d "$1" ]; then
  (>&2 echo "ERROR: No directory found at at $1")
  exit 1
fi

IN_DIR="$( realpath "$1" )"

mkdir -p "$2"
OUT_DIR="$( realpath "$2" )"

pushd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null

find "$IN_DIR" -type f |
  sort |
  while read -r inf; do
    ../shstMatching/shstMatchNPMRDS  "$inf" "$OUT_DIR"
  done

popd >/dev/null
