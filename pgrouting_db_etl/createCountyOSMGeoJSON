#!/bin/bash

# https://www.compose.com/articles/how-to-transform-and-use-openstreetmap-data-into-geojson-using-gdal/

set -e

cd "$( dirname "${BASH_SOURCE[0]}" )/"

if [ "$#" -ne 1 ]; then
  (>&2 echo 'USAGE: You must provide the OSM file using the first and only cli argument.')
  (>&2 echo '       Output written to STDOUT.')
  exit 1
fi

echo '{"type":"FeatureCollection","features":'

for gtype in points lines multilinestrings multipolygons ; do
  ogr2ogr -s_srs EPSG:4326 -t_srs EPSG:4326 -f GeoJSON /vsistdout/ "$1" "$gtype" |
    jq '.features[]'
done | jq -s '.'

echo '}'
